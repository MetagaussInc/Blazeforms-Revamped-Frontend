(self.webpackChunkblaze_forms=self.webpackChunkblaze_forms||[]).push([[325],{325:(e,t,i)=>{"use strict";i.r(t),i.d(t,{ManageRolesModule:()=>w});var o=i(8583),r=i(3679),s=i(526),n=i(7310),a=i(9336),l=i(4395),d=i(8002),c=i(7716),m=i(2595),u=i(3065),g=i(834),p=i(8974);function h(e,t){1&e&&(c.TgZ(0,"div",27),c._uU(1,"Role Name is required "),c.qZA())}function f(e,t){if(1&e&&(c.ynx(0),c.YNc(1,h,2,0,"div",15),c.BQk()),2&e){const e=c.oxw(2);c.xp6(1),c.Q6J("ngIf",(null==e.f.Name.errors?null:e.f.Name.errors.required)||(null==e.f.Name.errors?null:e.f.Name.errors.pattern))}}function Z(e,t){1&e&&(c.TgZ(0,"div",27),c._uU(1,"Role Name is already exist"),c.qZA())}function I(e,t){if(1&e&&(c.TgZ(0,"th"),c._uU(1),c.qZA()),2&e){const e=t.$implicit;c.xp6(1),c.Oqu(e.permissionName)}}function b(e,t){if(1&e&&(c.TgZ(0,"td",30),c._uU(1),c.qZA()),2&e){const e=c.oxw().$implicit;c.xp6(1),c.Oqu(e.moduleName)}}function A(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div"),c.TgZ(1,"input",33),c.NdJ("ngModelChange",function(t){return c.CHM(e),c.oxw(2).$implicit.isActive=t}),c.qZA(),c._UZ(2,"label",34),c.qZA()}if(2&e){const e=c.oxw(2).$implicit,t=c.oxw().$implicit;c.xp6(1),c.hYB("id","module-permission-",t.moduleId,"-",e.permissionId,""),c.Q6J("ngModel",e.isActive),c.xp6(1),c.hYB("for","module-permission-",t.moduleId,"-",e.permissionId,"")}}function v(e,t){if(1&e&&(c.ynx(0),c.YNc(1,A,3,5,"div",14),c.BQk()),2&e){const e=c.oxw().$implicit;c.xp6(1),c.Q6J("ngIf",e.isAvailable)}}function N(e,t){if(1&e&&(c.TgZ(0,"td"),c.YNc(1,v,2,1,"ng-container",14),c.qZA()),2&e){const e=c.oxw().$implicit;c.xp6(1),c.Q6J("ngIf","Forms"!=e.moduleName)}}function x(e,t){if(1&e&&(c.TgZ(0,"tr"),c.YNc(1,b,2,1,"td",32),c.YNc(2,N,2,1,"td",31),c.qZA()),2&e){const e=t.$implicit;c.xp6(1),c.Q6J("ngIf","Forms"!=e.moduleName),c.xp6(1),c.Q6J("ngForOf",e.modulePermissionList)}}function q(e,t){if(1&e&&(c.TgZ(0,"table",28),c.TgZ(1,"thead",29),c.TgZ(2,"tr"),c.TgZ(3,"th",30),c._uU(4,"Module"),c.qZA(),c.YNc(5,I,2,1,"th",31),c.qZA(),c.qZA(),c.TgZ(6,"tbody"),c.YNc(7,x,3,2,"tr",31),c.qZA(),c.qZA()),2&e){const e=c.oxw(2);c.xp6(5),c.Q6J("ngForOf",e.rolePermissionData.rolePermissionList),c.xp6(2),c.Q6J("ngForOf",e.rolePermissionData.roleModuleList)}}function U(e,t){1&e&&c._UZ(0,"span",37)}function T(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"button",35),c.NdJ("click",function(){return c.CHM(e),c.oxw(2).submit()}),c._uU(1," Save "),c.YNc(2,U,1,0,"span",36),c.qZA()}if(2&e){const e=c.oxw(2);c.Q6J("disabled",e.roleAddForm.invalid),c.xp6(2),c.Q6J("ngIf",e.isFormSubmitted)}}function S(e,t){if(1&e){const e=c.EpF();c.TgZ(0,"div",3),c.TgZ(1,"div",4),c.TgZ(2,"div",5),c.TgZ(3,"div",6),c.TgZ(4,"h4"),c._uU(5,"General Details"),c.qZA(),c.TgZ(6,"form",7),c.TgZ(7,"div",8),c.TgZ(8,"div",9),c.TgZ(9,"label",10),c._uU(10,"Name"),c.qZA(),c.TgZ(11,"span",11),c._uU(12," *"),c.qZA(),c.qZA(),c.TgZ(13,"div",12),c._UZ(14,"input",13),c.qZA(),c.YNc(15,f,2,1,"ng-container",14),c.YNc(16,Z,2,0,"div",15),c.qZA(),c.TgZ(17,"div",8),c.TgZ(18,"div",9),c.TgZ(19,"label",16),c._uU(20,"Description"),c.qZA(),c.qZA(),c.TgZ(21,"div",12),c._UZ(22,"textarea",17),c.qZA(),c.qZA(),c.TgZ(23,"div",8),c.TgZ(24,"div",9),c.TgZ(25,"label",18),c._uU(26,"Active"),c.qZA(),c.qZA(),c.TgZ(27,"div",12),c.TgZ(28,"div",19),c._UZ(29,"input",20),c._UZ(30,"label",21),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.TgZ(31,"div",22),c.TgZ(32,"h4"),c._uU(33,"Permissions under this role for modules"),c.qZA(),c.YNc(34,q,8,2,"table",23),c.TgZ(35,"div",24),c.TgZ(36,"button",25),c.NdJ("click",function(){return c.CHM(e),c.oxw().goBack()}),c._uU(37,"Back"),c.qZA(),c.YNc(38,T,3,2,"button",26),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA(),c.qZA()}if(2&e){const e=c.oxw();c.xp6(6),c.Q6J("formGroup",e.roleAddForm),c.xp6(9),c.Q6J("ngIf",e.f.Name.invalid&&(e.f.Name.dirty||e.f.Name.touched)),c.xp6(1),c.Q6J("ngIf",null==e.f.Name.errors?null:e.f.Name.errors.isExists),c.xp6(18),c.Q6J("ngIf",e.rolePermissionData),c.xp6(4),c.Q6J("ngIf",e.roleDetailsData.isEditable)}}const y=[{path:"",component:(()=>{class e{constructor(e,t,i,o,s,n,l){this.http=e,this.store=t,this.router=i,this.Activatedroute=o,this.dataSharingService=s,this.location=n,this.toastService=l,this.roleDetails=[],this.isFormSubmitted=!1,this.roleAddForm=new r.cw({Name:new r.NI("",[r.kI.required],this.validateRoleNameViaServer.bind(this)),Description:new r.NI(""),IsActive:new r.NI("")}),this.userInfoSubscription$=this.store.select(a.S8).subscribe(e=>{this.SuperUserId=e.Id}),this.Activatedroute.queryParamMap.subscribe(e=>{if(e.has("action")&&e.has("id")&&e.has("orgUserId")&&e.has("orgName")||this.router.navigate(["/work-spaces"]),"edit"==e.get("action")){let t=e.get("id"),i=e.get("orgUserId"),o=e.get("orgName"),r=e.get("roleId");this.organizationId=decodeURIComponent(t),this.organizationUserId=decodeURIComponent(i),this.organizationName=decodeURIComponent(o),r&&(this.roledataId=decodeURIComponent(r)),this.getRoleDetail(),this.rolePermissions=this.dataSharingService.GetPermissions("Role")}})}ngOnInit(){}getRoleDetail(){let e={};e=this.roledataId?{Id:this.roledataId,UserId:this.SuperUserId}:{UserId:this.SuperUserId},this.http.call("getRoleDetails","POST",e).subscribe(e=>{this.rolePermissionData=e.rolePermissionModel,this.roleDetailsData=e.roleDetails,this.roledataId&&this.roleAddForm.patchValue({Name:this.roleDetailsData.name,Description:this.roleDetailsData.description,IsActive:this.roleDetailsData.isActive})})}validateRoleNameViaServer({value:e}){return this.http.call("validateRoleName","POST",{Name:e,WorkSpaceId:this.SuperUserId}).pipe((0,l.b)(1e3),(0,d.U)(e=>e.id?{isExists:!0}:null))}submit(){this.isFormSubmitted=!0;let e=this.rolePermissionData.roleModuleList;if(e.length>0)for(let i of e){let e=[];for(let t of i.modulePermissionList)e.push({PermissionId:t.permissionId,IsSelected:t.isActive});this.roleDetails.push(null!==this.roledataId?{ModuleId:i.moduleId,Permissions:e,CreatedBy:this.SuperUserId,ModifiedBy:this.SuperUserId}:{RoleId:this.roledataId,ModuleId:i.moduleId,Permissions:e,CreatedBy:this.SuperUserId,ModifiedBy:this.SuperUserId})}let t={};t=Object.assign(Object.assign({},JSON.parse(JSON.stringify(this.roleAddForm.value))),this.roledataId&&null!==this.roledataId?{CreatedBy:this.SuperUserId,IsDeleted:!1,WorkSpaceId:this.organizationId,isEditable:!0,modulePermission:this.roleDetails,Id:this.roledataId,isActiveAssignedUser:!0}:{CreatedBy:this.SuperUserId,IsDeleted:!1,WorkSpaceId:this.organizationId,isEditable:!0,modulePermission:this.roleDetails}),this.http.call("saveRole","POST",t).subscribe(e=>{e.id&&(this.toastService.showSuccess(this.roledataId?"Updated Successfully!":"Saved Successfully!"),this.router.navigate(["/manage-work-spaces"],{queryParams:{action:"edit",id:this.organizationId,orgUserId:this.organizationUserId,orgName:this.organizationName}}))})}goBack(){this.location.back()}get Name(){return this.roleAddForm.get("Name")}get Description(){return this.roleAddForm.get("Description")}get IsActive(){return this.roleAddForm.get("IsActive")}get f(){return this.roleAddForm.controls}}return e.\u0275fac=function(t){return new(t||e)(c.Y36(m.O),c.Y36(u.yh),c.Y36(n.F0),c.Y36(n.gz),c.Y36(g.j),c.Y36(o.Ye),c.Y36(p.k))},e.\u0275cmp=c.Xpm({type:e,selectors:[["app-manage-roles"]],decls:5,vars:1,consts:[[1,"hero-banner","container-fluid","py-4","bg-light","mb-4","border-bottom"],[1,"container","py-4"],["class","manage-organization-container container",4,"ngIf"],[1,"manage-organization-container","container"],[1,"organization-wrapper","row","mb-5"],[1,"col-sm-12"],[1,"my-5","px-5","manage-organization-wrap"],[1,"organization-setting",3,"formGroup"],[1,"row","my-4","form-group"],[1,"col-md-3"],["for","role-name"],[1,"text-danger"],[1,"col-md-9"],["formControlName","Name","type","text","id","role-name",1,"form-control"],[4,"ngIf"],["class","field-error text-right mt-1 pr-2 small",4,"ngIf"],["for","role-description"],["formControlName","Description","rows","5","maxlength","200","cols","5","id","role-description",1,"form-control"],["for","currency-select "],[1,"custom-control","custom-switch"],["formControlName","IsActive","type","checkbox","id","bf_active_role",1,"custom-control-input"],["for","bf_active_role",1,"custom-control-label"],[1,"my-5"],["class","table mt-3 table-borderless text-center border",4,"ngIf"],[1,"form-group","mt-5","row","role-btn-container"],["type","button",1,"btn","btn-link","btn-md","text-bf",3,"click"],["type","button","class","btn btn-bf btn-md ml-3",3,"disabled","click",4,"ngIf"],[1,"field-error","text-right","mt-1","pr-2","small"],[1,"table","mt-3","table-borderless","text-center","border"],[1,"thead-light"],[1,"text-left"],[4,"ngFor","ngForOf"],["class","text-left",4,"ngIf"],["type","checkbox",3,"id","ngModel","ngModelChange"],[3,"for"],["type","button",1,"btn","btn-bf","btn-md","ml-3",3,"disabled","click"],["class","spinner-border spinner-border-sm mr-2",4,"ngIf"],[1,"spinner-border","spinner-border-sm","mr-2"]],template:function(e,t){1&e&&(c.TgZ(0,"div",0),c.TgZ(1,"div",1),c.TgZ(2,"h2"),c._uU(3,"Roles"),c.qZA(),c.qZA(),c.qZA(),c.YNc(4,S,39,5,"div",2)),2&e&&(c.xp6(4),c.Q6J("ngIf",t.rolePermissions.canEdit))},directives:[o.O5,r._Y,r.JL,r.sg,r.Fj,r.JJ,r.u,r.nD,r.Wl,o.sg,r.On],styles:[""]}),e})()}];let D=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[n.Bz.forChild(y)],n.Bz]}),e})(),w=(()=>{class e{}return e.\u0275fac=function(t){return new(t||e)},e.\u0275mod=c.oAB({type:e}),e.\u0275inj=c.cJS({imports:[[o.ez,D,r.u5,r.UX,s.IJ]]}),e})()}}]);