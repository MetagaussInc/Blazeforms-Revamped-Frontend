<!-- <form #parentForm="ngForm" (submit)="submitParentForm(parentForm)"> -->

<div *ngIf="haveTabs" class="formtabs-wrap sss">
    <ul ngbNav #formPublishTab="ngbNav" [(activeId)]="active" [destroyOnHide]="false" class="nav-tabs">
        <li *ngFor="let items of allArr; let i = index" [ngbNavItem]="i" [destroyOnHide]="false" class="mr-1">
            <a ngbNavLink>One</a>
            <ng-template ngbNavContent>
                <div class="ngx-dnd-container">
                    <ng-template ngFor let-form [ngForOf]="items" let-index="index" let-isLast="last">
                        <ng-container *ngIf="form.inputType === 'string'">
                            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                                <label [style.font-family]="styling?.labels?.font" [style.font-size.px]="styling?.labels?.size">{{form.name}}</label>
                                <input type="text" name="formFirld1_{{ form.uiIndexId }}" [(ngModel)]="form.value" placeholder="{{form.placeholder}}" [required]="checkForRDependency(form, 'reqDependUpOn')" class="form-control" />
                            </div>
                            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>

                        </ng-container>
                        <ng-container *ngIf="form.inputType === 'payment'">
                            <div style="pointer-events: none;" [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                                <label [style.font-family]="styling?.labels?.font" [style.font-size.px]="styling?.labels?.size">{{form.name}}</label>
                                <input type="text" name="formFirld1_{{ form.uiIndexId }}" [(ngModel)]="form.value" placeholder="{{form.placeholder}}" [required]="checkForRDependency(form, 'reqDependUpOn')" class="form-control" />
                            </div>
                            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>

                        </ng-container>
                        <ng-container *ngIf="form.inputType === 'number'">
                            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                                <label [style.font-family]="styling?.labels?.font" [style.font-size.px]="styling?.labels?.size">{{form.name}}</label>
                                <input type="number" name="formFirld1_{{ form.uiIndexId }}" [(ngModel)]="form.value" placeholder="{{form.placeholder}}" [required]="checkForRDependency(form, 'reqDependUpOn')" class="form-control" />
                            </div>
                            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>

                        </ng-container>
                        <ng-container *ngIf="form.inputType === 'section'">
                            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                                <label [style.font-family]="styling?.labels?.font" [style.font-size.px]="styling?.labels?.size">{{form.name}}</label>
                                <app-exported-form [elements]="form.childSection"></app-exported-form>
                            </div>
                            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>

                        </ng-container>
                        <ng-container *ngIf="form.inputType === 'repeatSection'">
                            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                                <label [style.font-family]="styling?.labels?.font" [style.font-size.px]="styling?.labels?.size">{{form.name}}</label>
                                <div (click)="form.childSection.push(form.childSection[form.childSection.length - 1])">
                                    Add</div>
                                <app-exported-form [elements]="form.childSection"></app-exported-form>


                            </div>
                            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>

                        </ng-container>
                        <ng-container *ngIf="form.inputType === 'fileupload'">
                            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                                <label [style.font-family]="styling?.labels?.font" [style.font-size.px]="styling?.labels?.size">{{form.name}}</label>
                                <input type="file" name="formFirld1_{{ form.uiIndexId }}" [(ngModel)]="form.value" placeholder="{{form.placeholder}}" [required]="checkForRDependency(form, 'reqDependUpOn')" class="form-control" />
                            </div>
                            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>

                        </ng-container>
                        <!-- <ng-container *ngIf="form.inputType === 'date'">
                                <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                                    <input type="{{form.inputType}}" name="formFirld1_{{ form.uiIndexId }}" [(ngModel)]="form.value" placeholder="{{form.placeholder}}" [required]="checkForRDependency(form, 'reqDependUpOn')" class="form-control" />
                                </div>
                                <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>
                    
                            </ng-container> -->
                        <ng-container *ngIf="form.inputType === 'radio'">
                            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                                <label [style.font-family]="styling?.labels?.font" [style.font-size.px]="styling?.labels?.size">{{form.name}}</label>
                                <div *ngFor="let option of form.options" class="custom-control custom-radio">
                                    <div (click)="form.value = option" class="custom-control custom-radio">
                                        <input name="radio" [value]="form.value" [checked]="form.value === option" id="radio_0{{option}}" type="radio" class="custom-control-input">
                                        <label for="radio_0" class="custom-control-label">{{option}}</label>
                                    </div>
                                </div>
                            </div>
                            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>

                        </ng-container>
                        <ng-container *ngIf="form.inputType === 'rating'">
                            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                                <label [style.font-family]="styling?.labels?.font" [style.font-size.px]="styling?.labels?.size">{{form.name}}</label>
                                <div class="row" *ngFor="let item of form.ratingOptions | keyvalue">
                                    <div class="col-2">{{item.key}}</div>
                                    <div class="col-2" *ngFor="let option of form.ratingScale[form.selectedRatingScale]">
                                        <input name="radio" name="formFirld1_{{ form.uiIndexId }}{{option}}" [value]="item.value" [checked]="item.value === option" id="radio_0{{option}}" type="radio" class="custom-control-input">
                                    </div>
                                </div>
                            </div>
                            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>

                        </ng-container>
                        <ng-container *ngIf="form.inputType === 'checkbox'">
                            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                                <label [style.font-family]="styling?.labels?.font" [style.font-size.px]="styling?.labels?.size">{{form.name}}</label>
                                <div *ngFor="let option of form.options" class="custom-control custom-checkbox">
                                    <input type="checkbox" id="rememberMe{{option}}" name="formFirld1_{{ form.uiIndexId }}{{option}}" [checked]="form.value.includes(option)" [value]="option" class="custom-control-input form-control">
                                    <label class="custom-control-label" for="rememberMe{{option}}">{{option}}</label>
                                </div>
                                <input type="{{form.inputType}}" name="formFirld1_{{ form.uiIndexId }}" [(ngModel)]="form.value" placeholder="{{form.placeholder}}" [required]="checkForRDependency(form, 'reqDependUpOn')" class="form-control" />
                            </div>
                            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>

                        </ng-container>
                        <ng-container *ngIf="form.inputType === 'dropdown'">
                            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                                <label class="col-form-label">{{form.name}}</label>
                                <select name="formFirld1_{{ form.uiIndexId }}" [required]="checkForRDependency(form, 'reqDependUpOn')" [(ngModel)]="form.value" class="custom-select">
                                        <option *ngFor="let option of form.options" [value]="option">
                                            {{option}}</option>
                                    </select>
                            </div>
                            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>

                        </ng-container>
                        <ng-container *ngIf="form.inputType === 'sign'">
                            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                                <label [style.font-family]="styling?.labels?.font" [style.font-size.px]="styling?.labels?.size">{{form.name}}</label>
                                <app-signature-field [model]="form"></app-signature-field>
                            </div>
                            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>
                        </ng-container>
                    </ng-template>
                </div>
            </ng-template>
        </li>
    </ul>

    <div [ngbNavOutlet]="formPublishTab" class="mt-2"></div>

    <!-- <pre>Active: {{ active }}</pre> -->

</div>
<div *ngIf="!haveTabs" class="ngx-dnd-container">
    <ng-template ngFor let-form [ngForOf]="elements" let-index="index" let-isLast="last">
        <ng-container *ngIf="form.inputType === 'string'">
            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                <label [style.font-family]="styling?.labels?.font" [style.font-size.px]="styling?.labels?.size">{{form.name}}</label>
                <input type="text" name="formFirld1_{{ form.uiIndexId }}" [(ngModel)]="form.value" placeholder="{{form.placeholder}}" [required]="checkForRDependency(form, 'reqDependUpOn')" class="form-control" />
            </div>
            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>

        </ng-container>
        <ng-container *ngIf="form.inputType === 'number'">
            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                <label [style.font-family]="styling?.labels?.font" [style.font-size.px]="styling?.labels?.size">{{form.name}}</label>
                <input type="number" name="formFirld1_{{ form.uiIndexId }}" [(ngModel)]="form.value" placeholder="{{form.placeholder}}" [required]="checkForRDependency(form, 'reqDependUpOn')" class="form-control" />
            </div>
            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>

        </ng-container>
        <ng-container *ngIf="form.inputType === 'section'">
            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                <label [style.font-family]="styling?.labels?.font" [style.font-size.px]="styling?.labels?.size">{{form.name}}</label>
                <app-exported-form [elements]="form.childSection"></app-exported-form>
            </div>
            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>

        </ng-container>
        <ng-container *ngIf="form.inputType === 'repeatSection'">
            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                <label [style.font-family]="styling?.labels?.font" [style.font-size.px]="styling?.labels?.size">{{form.name}}</label>
                <div (click)="form.childSection.push(form.childSection[form.childSection.length - 1])">
                    Add</div>
                <app-exported-form [elements]="form.childSection"></app-exported-form>


            </div>
            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>

        </ng-container>
        <ng-container *ngIf="form.inputType === 'fileupload'">
            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                <label [style.font-family]="styling?.labels?.font" [style.font-size.px]="styling?.labels?.size">{{form.name}}</label>
                <input type="file" name="formFirld1_{{ form.uiIndexId }}" [(ngModel)]="form.value" placeholder="{{form.placeholder}}" [required]="checkForRDependency(form, 'reqDependUpOn')" class="form-control" />
            </div>
            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>

        </ng-container>
        <!-- <ng-container *ngIf="form.inputType === 'date'">
                <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                    <input type="{{form.inputType}}" name="formFirld1_{{ form.uiIndexId }}" [(ngModel)]="form.value" placeholder="{{form.placeholder}}" [required]="checkForRDependency(form, 'reqDependUpOn')" class="form-control" />
                </div>
                <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>
    
            </ng-container> -->
        <ng-container *ngIf="form.inputType === 'radio'">
            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                <label [style.font-family]="styling?.labels?.font" [style.font-size.px]="styling?.labels?.size">{{form.name}}</label>
                <div *ngFor="let option of form.options" class="custom-control custom-radio">
                    <div (click)="form.value = option" class="custom-control custom-radio">
                        <input name="radio" [value]="form.value" [checked]="form.value === option" id="radio_0{{option}}" type="radio" class="custom-control-input">
                        <label for="radio_0" class="custom-control-label">{{option}}</label>
                    </div>
                </div>
            </div>
            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>

        </ng-container>
        <ng-container *ngIf="form.inputType === 'rating'">
            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                <label [style.font-family]="styling?.labels?.font" [style.font-size.px]="styling?.labels?.size">{{form.name}}</label>
                <div class="row" *ngFor="let item of form.ratingOptions | keyvalue">
                    <div class="col-2 dd">{{item.key}}</div>
                    <div class="custom-control custom-radio custom-control-inline" *ngFor="let option of form.ratingScale[form.selectedRatingScale]">
                        <label for="radio_0{{option}}" class="custom-control-label">
                            {{option}}
                        <input name="radio" name="formFirld1_{{ form.uiIndexId }}{{option}}" [value]="item.value" [checked]="item.value === option" id="radio_0{{option}}" type="radio" class="custom-control-input">
                    </label>
                    </div>
                </div>
            </div>
            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>

        </ng-container>
        <ng-container *ngIf="form.inputType === 'checkbox'">
            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                <label [style.font-family]="styling?.labels?.font" [style.font-size.px]="styling?.labels?.size">{{model.name}}</label>
                <div *ngFor="let option of form.options" class="custom-control custom-checkbox">
                    <input type="checkbox" id="rememberMe{{option}}" name="formFirld1_{{ form.uiIndexId }}{{option}}" [checked]="form.value.includes(option)" [value]="option" class="custom-control-input form-control">
                    <label class="custom-control-label" for="rememberMe{{option}}">{{option}}</label>
                </div>
                <input type="{{form.inputType}}" name="formFirld1_{{ form.uiIndexId }}" [(ngModel)]="form.value" placeholder="{{form.placeholder}}" [required]="checkForRDependency(form, 'reqDependUpOn')" class="form-control" />
            </div>
            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>

        </ng-container>
        <ng-container *ngIf="form.inputType === 'dropdown'">
            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                <label class="col-form-label">{{form.name}}</label>
                <select name="formFirld1_{{ form.uiIndexId }}" [required]="checkForRDependency(form, 'reqDependUpOn')" [(ngModel)]="form.value" class="custom-select">
                        <option *ngFor="let option of form.options" [value]="option">
                            {{option}}</option>
                    </select>
            </div>
            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>

        </ng-container>
        <ng-container *ngIf="form.inputType === 'sign'">
            <div [class]="form.size + ' ngx-dnd-item'" *ngIf="!form?.dependUpon || checkForDependency(form, 'dependUpon') ">
                <label [style.font-family]="styling?.labels?.font" [style.font-size.px]="styling?.labels?.size">{{form.name}}</label>
                <app-signature-field [model]="form"></app-signature-field>
            </div>
            <div *ngIf="submitted && (!form.value || form.value?.length === 0) && checkForRDependency(form, 'reqDependUpOn')">Form field 1 is required</div>
        </ng-container>
        <ng-container *ngIf="form.inputType === 'payment'"></ng-container>
    </ng-template>
</div>
<div *ngIf="initial" class="item-payment-wrap">
    <ng-container *ngIf="initial.showLineItems">
        <div *ngFor="let item of payments" class="row lower">
            <div class="col-12 text-right">{{item.name}} <span class="pl-2">$ {{item.value}}</span></div>

        </div>
    </ng-container>


    <div *ngIf="initial.showSubTotal" class="row lower">
        <div class="col-12 text-right"> <strong>Sub Total</strong><span class="pl-2">$ {{getSubTotal()}}</span></div>
    </div>
    <hr class="mb-4">
    <div class="row lower">
        <div class="col-12 text-right"><strong>Amount Due</strong><span class="pl-2">$ {{getAmountDue()}}</span></div>
    </div>
    <div class="row lower">
        <div class="col-md-12 text-right">
            <div class="custom-control custom-radio" (click)="initial.selectedPaymentOption = 'Card'">
                <input name="radio" [checked]="initial.selectedPaymentOption === 'Card'" [value]="'Card'" id="radio_card" type="radio" class="custom-control-input">
                <label for="radio_card" class="custom-control-label">Card</label>
            </div>

            <div class="custom-control custom-radio" (click)="initial.selectedPaymentOption = 'Cash'">
                <input name="radio" [checked]="initial.selectedPaymentOption === 'Cash'" [value]="'Cash'" id="radio_cash" type="radio" class="custom-control-input">
                <label for="radio_cash" class="custom-control-label">Cash</label>
            </div>
        </div>

    </div>
</div>
<div class="row">
    <div class="col-md-12">
        <div class="form-btn-group my-3">
            <button *ngIf="active !== 0" (click)="active = active - 1" class="btn btn-bf btn-md">back</button>
            <button *ngIf="active !== allArr.length - 1" (click)="active = active + 1" class="btn btn-bf btn-md">Next</button>
            <button *ngIf="!initial || initial?.selectedPaymentOption === 'Cash' && getAmountDue() === 0" [ngClass]="{'p-right': haveTabs}" type="submit" class="btn btn-bf btn-md" (click)="submitParentForm('parentForm')">Submit</button>
            <button *ngIf="(initial && initial?.selectedPaymentOption === 'Card') && getAmountDue() !== 0" [ngClass]="{'p-right': haveTabs}" type="submit" class="btn btn-bf btn-md" (click)="billPay()">Proceed to Payment</button>
        </div>
    </div>
</div>

<!-- </form> -->